let fetch,Covid;_7ac‍.w("node-fetch",[["default",["fetch"],function(v){fetch=v}]]);_7ac‍.w("../models/datacovid",[["Covid",["Covid"],function(v){Covid=v}]]);


// FETCH & POST
exports.fetchAPI = async (req, res) => {
  const url = "https://data.covid19.go.id/public/api/update.json";
  const options = {
    method: "GET",
  };

  const response = await fetch(url, options).then((res) => res.json());
  const data = new Covid({
    penambahan: {
      jumlah_positif: response.update.penambahan.jumlah_positif,
      jumlah_meninggal: response.update.penambahan.jumlah_meninggal,
      jumlah_sembuh: response.update.penambahan.jumlah_sembuh,
      jumlah_dirawat: response.update.penambahan.jumlah_dirawat,
      tanggal: response.update.penambahan.tanggal,
      created: response.update.penambahan.created,
    },
    total: {
      jumlah_positif: response.update.total.jumlah_positif,
      jumlah_dirawat: response.update.total.jumlah_dirawat,
      jumlah_sembuh: response.update.total.jumlah_sembuh,
      jumlah_meninggal: response.update.total.jumlah_meninggal,
    },
  });
  // Save to Mongodb
  data
    .save()
    .then((doc) => {
      res.status(200).send(doc);
    })
    .catch((err) => {
      res.status(400).send(err);
      _7ac‍.g.console.error({
        message: "Error",
        error: err,
      });
    });
};

// GET DATA
exports.getData = async (req, res) => {
  try {
    let data = await Covid.find().then((covids) => {
      res.send({
        status: "success",
        data: covids,
      });
    });
  } catch (error) {
    _7ac‍.g.console.log(error);
    res.status(500).send({
      status: "failed",
      message: "Server error",
    });
  }
};
